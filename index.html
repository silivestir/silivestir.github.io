<!doctype html>
<html lang=en>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>kiswahiliScript</title>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/codemirror.min.css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/theme/dracula.min.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/codemirror.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/mode/javascript/javascript.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/edit/matchbrackets.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/edit/closebrackets.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/hint/show-hint.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/hint/javascript-hint.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.slim.min.js></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/hint/show-hint.min.css>
<style>.CodeMirror{border:1px solid #ddd;height:auto}.hidden{display:none}.file-list{display:flex;overflow-x:auto;padding:10px 0}.file-list-item{cursor:pointer;padding:10px;margin-right:10px;border-radius:4px;text-align:center;transition:background-color .3s,color .3s}.file-list-item:hover{background-color:#f1f1f1}.file-list-item.active{background-color:#007bff;color:#fff;border-bottom:3px solid #0056b3}.navbar{margin-bottom:20px}.file-list-item i{font-size:24px}#outputContainer{background:#282a36;color:#f8f8f2;padding:10px;border:1px solid #44475a;border-radius:4px;font-family:monospace;white-space:pre-wrap}.modal{display:none;position:fixed;z-index:1050;left:0;top:0;width:100%;height:100%;overflow:hidden;outline:0}.modal-dialog{position:relative;width:auto;margin:10px}.modal-content{position:relative;background-color:#fff;border:1px solid #999;border-radius:.3rem;outline:0;box-shadow:0 3px 9px rgba(0,0,0,.5)}.modal-header{padding:.75rem 1.25rem;border-bottom:1px solid #e9ecef}.modal-body{position:relative;padding:1.25rem}.modal-footer{padding:.75rem 1.25rem;border-top:1px solid #e9ecef;text-align:right}.modal-open .modal{display:block}</style>
</head>
<body>
<div class="container mt-4">
<div class="navbar navbar-expand-lg navbar-light bg-light">
<button class="btn btn-primary mr-2" onclick=openModal()>
<i class="fas fa-plus"></i> Create File
</button>
<button class="btn btn-warning mr-2" onclick=toggleTerminal()>
<i class="fas fa-terminal"></i> Terminal
</button>
<button class="btn btn-secondary mr-2" onclick=toggleEditor()>
<i class="fas fa-toggle-on"></i> Toggle Editor/Output
</button>
<button class="btn btn-success" onclick=saveFile()>
<i class="fas fa-save"></i> Save File
</button>
</div>
<div id=fileList class="file-list mt-2"></div>
<div id=editorContainer class=mt-2>
<textarea id=code></textarea>
</div>
<div id=terminalContainer class="mt-2 hidden">
<div id=terminalOutput class="border p-3" style=background:#000;color:#fff;font-family:monospace;height:300px;overflow-y:auto></div>
<textarea id=terminalInput class="form-control mt-2" rows=3 placeholder="Type your command here..."></textarea>
</div>
<div id=outputContainer class="mt-2 hidden">
<div id=s></div>
</div>
<div class=modal id=fileModal>
<div class=modal-dialog>
<div class=modal-content>
<div class=modal-header>
<h5 class=modal-title>Create New File</h5>
<button type=button class=close onclick=closeModal()>
<span aria-hidden=true>&times;</span>
</button>
</div>
<div class=modal-body>
<form id=fileForm>
<div class=form-group>
<label for=fileName>File Name (must end with .kiss)</label>
<input class=form-control id=fileName required>
</div>
<button type=submit class="btn btn-primary">Create File</button>
</form>
</div>
</div>
</div>
</div>
</div>
<script src=https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js></script>
<script>var editor=CodeMirror.fromTextArea(document.getElementById("code"),{mode:"javascript",theme:"dracula",lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete"}});editor.setValue("$a = 2;\n\nwakati [ a < 100 ] {\n  $b = 2;\n  $niNambaTasa = 0;\n  wakati [ b <= a / 2 ] {\n    kama [ !a % b == 0 ] {\n      b = b + 1;\n    } au {\n      b = a;\n      niNambaTasa = 1;\n    };\n  };\n  kama [ !niNambaTasa ] {\n    andika a + ' ni namba tasa';\n    andika;\n  };\n  a = a + 1;\n};\n\nkazi semaHabari:jina: => {\n  andika 'habari ' + jina;\n};\n\nsemaHabari:'Johnny':;\n\n$counter = 0;\n\nwakati [ counter < 10 ] {\n  andika counter;\n  counter = counter + 1;\n};\n\n$jina = 'Patricia';\n\nandika jina;\n\nkazi kulaTikiti:: => {\n  andika 'ninakula tikiti';\n  idadiYaTikiti = idadiYaTikiti - 1;\n  andika 'zina ' + idadiYaTikiti + ' zilizobaki';\n  andika;\n};\n\n$idadiYaTikiti = 20;\n\nwakati [ idadiYaTikiti > 5 ] {\n  kulaTikiti::;\n};\n");var files={},currentFileName=null;function createFile(e){e.endsWith(".kiss")?files[e]?alert("File already exists"):(files[e]="",currentFileName=e,updateFileList(),closeModal()):alert("File must end with .kiss")}function updateFileList(){const e=document.getElementById("fileList");e.innerHTML="",Object.keys(files).forEach((t=>{const i=document.createElement("div");i.className="file-list-item"+(t===currentFileName?" active":""),i.innerHTML=`<i class="fas fa-file-code"></i><br>${t}`,i.onclick=()=>loadFile(t),e.appendChild(i)}))}function loadFile(e){currentFileName=e,editor.setValue(files[e]),document.getElementById("editorContainer").classList.remove("hidden"),document.getElementById("outputContainer").classList.add("hidden"),updateFileList()}function saveFile(){currentFileName?(files[currentFileName]=editor.getValue(),alert("File saved!")):alert("No file selected to save.")}function toggleEditor(){var e=document.getElementById("editorContainer"),t=document.getElementById("outputContainer");e.classList.contains("hidden")?(e.classList.remove("hidden"),t.classList.add("hidden")):(e.classList.add("hidden"),e.classList.add("hidden"),t.classList.remove("hidden"),Compile())}class Environment{constructor(e){this.errorHandler=new ErrorHandler,this.values={},this.enclosing=null,e&&(this.enclosing=e)}define(e,t){this.values[e]=t}assign(e,t){if(Object.keys(this.values).includes(e))this.values[e]=t;else{if(this.enclosing)return this.enclosing.assign(e,t);this.errorHandler.throw(`UNDEFINED VARIABLE ${e}`)}}get(e){return Object.keys(this.values).includes(e)?this.values[e]:this.enclosing?this.enclosing.get(e):void this.errorHandler.throw(`UNDEFINED VARIABLE ${e}`)}}class ErrorHandler{constructor(){this.log=globalLog}throw(e,t,i){let n;n=t&&i?`\n\n${e} -- ln: ${t}, col: ${i}\n`:`\n\n${e}\n`;try{throw new Error(n)}catch(e){console.error(e),this.log.error(e,t)}}}class Assignment{constructor(e,t,i,n){this.identifier=e.value,this.expression=t,this.evaluator=i,this.environment=n,this.evaluator.load(t),this.value=this.evaluator.evaluate().value,this.operate()}operate(){this.environment.assign(this.identifier,this.value)}}class Binary{constructor(e,t,i,n){this.evaluator=n,this.evaluator.load(e),this.leftNode=this.evaluator.evaluate(),this.evaluator.load(i),this.rightNode=this.evaluator.evaluate(),this.operator=t.type,this.value=this.operate()}operate(){return"PLUS"==this.operator?this.leftNode.value+this.rightNode.value:"MINUS"==this.operator?this.leftNode.value-this.rightNode.value:"MULTIPLY"==this.operator?this.leftNode.value*this.rightNode.value:"DIVIDE"==this.operator?this.leftNode.value/this.rightNode.value:"MODULO"==this.operator?this.leftNode.value%this.rightNode.value:"EQUALTO"==this.operator?this.leftNode.value==this.rightNode.value:"NOTEQUALTO"==this.operator?this.leftNode.value!=this.rightNode.value:"GREATERTHAN"==this.operator?this.leftNode.value>this.rightNode.value:"LESSTHAN"==this.operator?this.leftNode.value<this.rightNode.value:"GREATERTHANEQUAL"==this.operator?this.leftNode.value>=this.rightNode.value:"LESSTHANEQUAL"==this.operator?this.leftNode.value<=this.rightNode.value:void 0}}class Unary{constructor(e,t,i){this.evaluator=i,this.evaluator.load(t),this.operator=e,this.expression=t,this.value=this.operate()}operate(){return"MINUS"==this.operator.type?-this.evaluator.evaluate().value:"PLUS"==this.operator.type?this.evaluator.evaluate().value:"NOT"==this.operator.type?!this.evaluator.evaluate().value:void 0}}class Call{constructor(e,t,i,n){this.errorHandler=new ErrorHandler,this.callee=e,this.evaluator=i,this.args=this.evaluateArgs(t),this.environment=n,this.value=this.operate()}evaluateArgs(e){let t=[];for(let i of e){this.evaluator.load(i);let e=this.evaluator.evaluate().value;t.push(e)}return t}operate(){const e=this.environment.get(this.callee.value);return e instanceof ZapFunction||this.errorHandler.throw("INVALID CALLEE TYPE",this.callee.line,this.callee.col),e.call(this.args)}}class Literal{constructor(e){"NUMBER"==e.type&&(this.value=parseFloat(e.value)),"STRING"==e.type&&(this.value=e.value)}}class Group{constructor(e,t){this.evaluator=t,this.evaluator.load(e),this.value=this.evaluator.evaluate().value}}class Variable{constructor(e,t){this.identifier=e.value,this.environment=t,this.value=this.fetchValue()}fetchValue(){return this.environment.get(this.identifier)}}class Evaluator{constructor(e){this.environment=e,this.errorHandler=new ErrorHandler,this.rawExpression=null,this.index=null,this.previousToken=null,this.currentToken=null,this.nextToken=null,this.openingParen=0,this.closingParen=0,this.bars=0}load(e){this.rawExpression=e,this.resetToEnd()}reset(){this.index=0,this.previousToken=null,this.currentToken=this.rawExpression[this.index],this.nextToken=this.rawExpression[this.index+1],this.openingParen=0,this.closingParen=0,this.checkParenthese(),this.checkBar()}resetToEnd(){this.index=this.rawExpression.length-1,this.previousToken=this.rawExpression[this.index-1],this.currentToken=this.rawExpression[this.index],this.nextToken=null,this.openingParen=0,this.closingParen=0,this.checkParenthese(),this.checkBar()}next(){this.index++,this.previousToken=this.rawExpression[this.index-1],this.currentToken=this.rawExpression[this.index],this.nextToken=this.rawExpression[this.index+1],this.checkParenthese(),this.checkBar()}prev(){this.index--,this.previousToken=this.rawExpression[this.index-1],this.currentToken=this.rawExpression[this.index],this.nextToken=this.rawExpression[this.index+1],this.checkParenthese(),this.checkBar()}checkParenthese(){this.currentToken&&("LPAREN"==this.currentToken.type&&this.openingParen++,"RPAREN"==this.currentToken.type&&this.closingParen++)}checkBar(){this.currentToken&&"BAR"==this.currentToken.type&&this.bars++}isInGroup(){return this.openingParen!=this.closingParen||this.bars%2!=0}isOperator(e){return["MULTIPLY","DIVIDE","PLUS","MINUS","MODULO","GREATERTHAN","GREATERTHANEQUAL","LESSTHAN","LESSTHANEQUAL","EQUALTO","NOTEQUALTO","NOT"].includes(e.type)}isEqualityOperator(e){return["EQUALTO","NOTEQUALTO"].includes(e.type)}isComparissonOperator(e){return["GREATERTHAN","GREATERTHANEQUAL","LESSTHAN","LESSTHANEQUAL"].includes(e.type)}isAdditionOperator(e){return["PLUS","MINUS"].includes(e.type)}isMultiplicationOperator(e){return["MULTIPLY","DIVIDE","MODULO"].includes(e.type)}isUnaryOperator(e){return["MINUS","NOT","PLUS"].includes(e.type)}isLiteral(e){return["STRING","NUMBER"].includes(e.type)}isReserved(e){return["FOR","WHILE","RETURN","SHOW"].includes(e.type)}isForbidden(e){return["RBRACE","LBRACE","SEMICOLON","DOT","DECLARATOR"].includes(e.type)}handleAssignment(){let e=this.rawExpression.slice(0,this.index),t=this.rawExpression.slice(this.index+1);1==e.length&&t.length||this.errorHandler.throw("UNABLE TO PARSE ASSIGNMENT",this.currentToken.line,this.currentToken.col);let i=e[0];return"IDENTIFIER"!=i.type&&this.errorHandler.throw("INVALID ASSIGNEE",this.currentToken.line,this.currentToken.col),new Assignment(i,t,this,this.environment)}handleBinary(){let e=this.rawExpression.slice(0,this.index),t=this.rawExpression.slice(this.index+1);return e.length&&t.length||this.errorHandler.throw("UNABLE TO PARSE BINARY EXPRESSION",this.currentToken.line,this.currentToken.col),new Binary(e,this.currentToken,t,this)}handleUnary(){let e=this.rawExpression.slice(this.index+1);return e.length||this.errorHandler.throw("UNABLE TO PARSE UNARY EXPRESSION",this.currentToken.line,this.currentToken.col),new Unary(this.currentToken,e,this)}handleCall(){let e=this.previousToken,t=[],i=[];for(this.next(),this.currentToken||this.errorHandler.throw("UNABLE TO PARSE CALL EXPRESSION",this.previousToken.line,this.previousToken.col);"BAR"!=this.currentToken.type;)"COMMA"!=this.currentToken.type?i.push(this.currentToken):(t.push(i),i=[]),this.next(),this.currentToken||this.errorHandler.throw("EXPECTED '|' after argument list",this.previousToken.line,this.previousToken.col);return i.length&&(t.push(i),i=[]),new Call(e,t,this,this.environment)}handleOpenParen(){let e=[];for(;this.isInGroup();)e.push(this.currentToken),this.next(),this.currentToken||this.errorHandler.throw("EXPECTED ')' AFTER EXPRESSION -- EOF");return new Group(e,this)}handlePrimary(){return new Literal(this.currentToken)}handleVariable(){return new Variable(this.currentToken,this.environment)}handleReserved(){this.errorHandler.throw("UNEXPECTED KEYWORD",this.currentToken.line,this.currentToken.col)}handleForbidden(){this.errorHandler.throw("FORBIDDEN SYMBOL IN EXPRESSION",this.currentToken.line,this.currentToken.col)}evaluate(){for(;this.currentToken;)this.isForbidden(this.currentToken)&&this.handleForbidden(),this.prev();for(this.resetToEnd();this.currentToken;)this.isReserved(this.currentToken)&&this.handleReserved(),this.prev();for(this.reset();this.currentToken&&this.nextToken;)this.isLiteral(this.currentToken)&&this.isLiteral(this.nextToken)&&this.errorHandler.throw("UNEXPECTED LITERAL",this.nextToken.line,this.nextToken.col),this.next();for(this.reset();this.currentToken;){if("EQUALS"==this.currentToken.type&&!this.isInGroup())return this.handleAssignment();this.next()}for(this.resetToEnd();this.index>=0;){if(this.isEqualityOperator(this.currentToken)&&!this.isInGroup())return this.handleBinary();this.prev()}for(this.resetToEnd();this.index>=0;){if(this.isComparissonOperator(this.currentToken)&&!this.isInGroup())return this.handleBinary();this.prev()}for(this.resetToEnd();this.index>=0;){if(this.isAdditionOperator(this.currentToken)&&!this.isInGroup()&&this.previousToken&&!this.isOperator(this.previousToken))return this.handleBinary();this.prev()}for(this.resetToEnd();this.index>=0;){if(this.isMultiplicationOperator(this.currentToken)&&!this.isInGroup())return this.handleBinary();this.prev()}for(this.reset();this.currentToken;){if(this.isUnaryOperator(this.currentToken)&&!this.isInGroup())return this.handleUnary();this.next()}for(this.reset();this.currentToken;){if("BAR"==this.currentToken.type)return this.handleCall();this.next()}for(this.reset();this.currentToken;){if("LPAREN"==this.currentToken.type)return this.next(),this.handleOpenParen();this.next()}for(this.reset();this.currentToken;){if("NUMBER"==this.currentToken.type||"STRING"==this.currentToken.type)return this.handlePrimary();this.next()}for(this.reset();this.currentToken;){if("IDENTIFIER"==this.currentToken.type)return this.handleVariable();this.next()}return this.reset(),{value:void 0}}}class Interpreter{constructor(e){globalLog.clear(),this.errorHandler=new ErrorHandler,this.environment=new Environment(null),this.lexer=new Lexer(e),this.parser=new Parser(this.environment),this.parser.load(this.lexer.tokens),this.statements=this.parser.parse()}}class CharSeperator{constructor(e){this.errorHandler=new ErrorHandler,this.input=e,this.charTypes=[],this.getCharTypes()}getCharTypes(){let e=1,t=1;for(let i of this.input.split("")){for(let[n,r]of Object.entries(tokenList))if(r(i)){const r={};r.type=n,r.line=e,r.col=t,r.value=i,"UNRECOGNIZED"==r.type?this.errorHandler.throw("UNRECOGNIZED SYNTAX",r.line,r.col):this.charTypes.push(r);break}"\n"==i?(t=1,e++):t++}}}class Lexer{constructor(e){this.charSeperator=new CharSeperator(e),this.errorHandler=new ErrorHandler,this.charTypes=this.charSeperator.charTypes,this.index=0,this.char=this.charTypes[this.index],this.currentToken={},this.tokens=[],this.lex()}resetCurrentToken(){this.currentToken={}}next(){this.index++,this.char=this.charTypes[this.index]}peakNext(){try{return this.charTypes[this.index+1]}catch{return!1}}handleStr(){for(this.currentToken={type:"STRING",line:this.char.line,col:this.char.col,value:""},this.peakNext()?this.next():this.errorHandler.throw("EOF WHILE PARSING STRING",this.currentToken.line,this.currentToken.col);"QUOTE"!=this.char.type;)this.currentToken.value=this.currentToken.value.concat(this.char.value),this.next(),this.char||this.errorHandler.throw("EOF WHILE PARSING STRING",this.currentToken.line,this.currentToken.col);this.tokens.push(this.currentToken),this.resetCurrentToken(),this.next(),this.lex()}handleNum(){let e=!1;for(this.currentToken={type:"NUMBER",line:this.char.line,col:this.char.col,value:""};("NUMBER"==this.char.type||!e&&"DOT"==this.char.type&&this.peakNext()&&"NUMBER"==this.peakNext().type)&&("DOT"==this.char.type&&(e=!0),this.currentToken.value=this.currentToken.value.concat(this.char.value),this.next(),this.char););this.tokens.push(this.currentToken),this.resetCurrentToken(),this.lex()}handleId(){for(this.currentToken={type:"IDENTIFIER",line:this.char.line,col:this.char.col,value:""};("NUMBER"==this.char.type||"LETTER"==this.char.type)&&(this.currentToken.value=this.currentToken.value.concat(this.char.value),this.next(),this.char););Object.keys(reserved).includes(this.currentToken.value)&&(this.currentToken.type=reserved[this.currentToken.value]),this.tokens.push(this.currentToken),this.resetCurrentToken(),this.lex()}isDoubleCharOperator(){if(this.peakNext()){let e=this.char.value.concat(this.peakNext().value);for(let[t,i]of Object.entries(tokenList))if(i(e)&&"UNRECOGNIZED"!=t)return{type:t,line:this.char.line,col:this.char.col,value:e};return!1}}handleOperator(){if("WHITESPACE"!=this.char.type){let e=this.isDoubleCharOperator();e?(this.next(),this.currentToken=e,this.tokens.push(this.currentToken),this.resetCurrentToken()):(this.currentToken=this.char,this.tokens.push(this.currentToken),this.resetCurrentToken())}this.next(),this.lex()}lex(){if(this.char)switch(this.char.type){case"QUOTE":this.handleStr();break;case"NUMBER":this.handleNum();break;case"LETTER":this.handleId();break;default:this.handleOperator()}}}const tokenList={PLUS:e=>"+"==e,MINUS:e=>"-"==e,DIVIDE:e=>"/"==e,MULTIPLY:e=>"*"==e,MODULO:e=>"%"==e,EQUALS:e=>"="==e,GREATERTHAN:e=>">"==e,LESSTHAN:e=>"<"==e,NOT:e=>"!"==e,GREATERTHANEQUAL:e=>">="==e,LESSTHANEQUAL:e=>"<="==e,NOTEQUALTO:e=>"!="==e,EQUALTO:e=>"=="==e,FATARROW:e=>"=>"==e,LPAREN:e=>"["==e,RPAREN:e=>"]"==e,LBRACE:e=>"{"==e,RBRACE:e=>"}"==e,BAR:e=>":"==e,COMMA:e=>","==e,SEMICOLON:e=>";"==e,QUOTE:e=>"'"==e,DOT:e=>"."==e,DECLARATOR:e=>"$"==e,NUMBER:e=>/^[0-9]+$/.test(e),LETTER:e=>/^[a-zA-Z😘😂💕❤💓]+$/.test(e),WHITESPACE:e=>!/\S/.test(e),UNRECOGNIZED:e=>!0},reserved={ikiwa:"FOR",wakati:"WHILE",rudisha:"RETURN",andika:"SHOW",kama:"IF",au:"ELSE",kazi:"FUNCTION"};class Log{constructor(){this.values=[]}add(e){this.values.push({log:e})}error(e,t){this.values.push({error:{message:e.message,line:t}})}clear(){return this.values=[],this}}let globalLog=new Log;class BlockStmt{constructor(e,t){this.statement=e,this.body=this.fetchBody(),this.parser=new Parser(t),this.execute()}fetchBody(){return this.statement.slice(1,-1)}execute(){this.parser.load(this.body),this.statements=this.parser.parse()}}class PrintStmt{constructor(e,t,i){this.log=i,this.statement=e,this.expression=this.fetchExpression(),this.evaluator=t,this.value=null,this.execute()}fetchExpression(){return this.statement.slice(1)}execute(){this.evaluator.load(this.expression),this.value=this.evaluator.evaluate().value,null!=this.value?this.log.add(this.value):this.log.add("")}}class ExprStmt{constructor(e,t){this.expression=e,this.evaluator=t,this.evaluator.load(this.expression),this.value=this.evaluator.evaluate().value}}class DeclarationStmt{constructor(e,t,i){this.errorHandler=new ErrorHandler,this.statement=e,this.evaluator=t,this.environment=i,this.value=null,this.identifier=e[1].value,this.execute()}fetchValue(){let e=null;if(this.statement[2])if("EQUALS"==this.statement[2].type){let t=this.statement.slice(3);this.evaluator.load(t),e=this.evaluator.evaluate().value,null==e&&this.errorHandler.throw("INVALID DECLARATION STATEMENT",this.statement[0].line,this.statement[0].col)}else this.errorHandler.throw("INVALID DECLARATION STATEMENT",this.statement[0].line,this.statement[0].col);return e}execute(){return this.value=this.fetchValue(),this.environment.define(this.identifier,this.value)}}class IfStmt{constructor(e,t,i){this.evaluator=t,this.parser=new Parser(i),this.errorHandler=new ErrorHandler,this.statement=e,this.expression=[],this.thenBlock=[],this.elseBlock=null,this.index=1,this.currentToken=this.statement[this.index],this.prevToken=null,this.openingBrace=0,this.closingBrace=0,this.execute()}next(){this.prevToken=this.statement[this.index],this.index++,this.currentToken=this.statement[this.index],this.checkBrace()}checkBrace(){this.currentToken&&("LBRACE"==this.currentToken.type&&this.openingBrace++,"RBRACE"==this.currentToken.type&&this.closingBrace++)}isInBlock(){return this.closingBrace!=this.openingBrace}splitBlock(){for(;!this.isInBlock();)this.expression.push(this.currentToken),this.next(),this.currentToken||this.errorHandler.throw("EXPECTED '{' AFTER EXPRESSION",this.prevToken.line,this.prevToken.col);for(;this.isInBlock();)this.thenBlock.push(this.currentToken),this.next(),this.currentToken||this.errorHandler.throw("EXPECTED '}' AFTER THEN BLOCK",this.prevToken.line,this.prevToken.col);if(this.thenBlock.push(this.currentToken),this.thenBlock.push({type:"SEMICOLON",value:";"}),this.next(),this.currentToken)if("ELSE"==this.currentToken.type)if(this.next(),this.isInBlock()){for(this.elseBlock=[];this.isInBlock();)this.elseBlock.push(this.currentToken),this.next(),this.currentToken||this.errorHandler.throw("EXPECTED '}' AFTER ELSE BLOCK",this.prevToken.line,this.prevToken.col);this.elseBlock.push(this.currentToken),this.elseBlock.push({type:"SEMICOLON",value:";"}),this.next()}else this.errorHandler.throw("UNABLE TO PARSE ELSE STATEMENT",this.prevToken.line,this.prevToken.col);else this.errorHandler.throw("UNEXPECTED KEYWORD AFTER IF STATEMENT",this.prevToken.line,this.prevToken.col)}execute(){this.splitBlock(),this.evaluator.load(this.expression);let e=this.evaluator.evaluate().value;e&&(this.parser.load(this.thenBlock),this.parser.parse()),e||this.elseBlock&&(this.parser.load(this.elseBlock),this.parser.parse())}}class WhileStmt{constructor(e,t,i){this.evaluator=t,this.parser=new Parser(i),this.errorHandler=new ErrorHandler,this.statement=e,this.expression=[],this.body=[],this.index=1,this.currentToken=this.statement[this.index],this.prevToken=null,this.openingBrace=0,this.closingBrace=0,this.execute()}next(){this.prevToken=this.statement[this.index],this.index++,this.currentToken=this.statement[this.index],this.checkBrace()}checkBrace(){this.currentToken&&("LBRACE"==this.currentToken.type&&this.openingBrace++,"RBRACE"==this.currentToken.type&&this.closingBrace++)}isInBlock(){return this.closingBrace!=this.openingBrace}splitBlock(){for(;!this.isInBlock();)this.expression.push(this.currentToken),this.next(),this.currentToken||this.errorHandler.throw("EXPECTED '{' AFTER EXPRESSION",this.prevToken.line,this.prevToken.col);for(;this.isInBlock();)this.body.push(this.currentToken),this.next(),this.currentToken||this.errorHandler.throw("EXPECTED '}' AFTER BODY OF WHILE",this.prevToken.line,this.prevToken.col);this.body.push(this.currentToken),this.body.push({type:"SEMICOLON",value:";"}),this.next(),this.currentToken&&this.errorHandler.throw("UNEXPECTED TOKEN AFTER WHILE STATEMENT",this.currentToken.line,this.currentToken.col)}execute(){this.splitBlock();let e=1e3;for(this.evaluator.load(this.expression);this.evaluator.evaluate().value;)if(this.parser.load(this.body),this.parser.parse(),this.evaluator.load(this.expression),e--,e<=0){this.errorHandler.throw("MAXIMUM NUMBER OF LOOPS EXCEEDED");break}}}class FunctionStmt{constructor(e,t,i){this.evaluator=t,this.environment=i,this.errorHandler=new ErrorHandler,this.statement=e,this.identifier=null,this.args=[],this.body=[],this.index=1,this.currentToken=this.statement[this.index],this.prevToken=null,this.execute()}next(){this.prevToken=this.statement[this.index],this.index++,this.currentToken=this.statement[this.index]}splitBlock(){for(this.identifier=this.currentToken.value,this.next(),this.currentToken&&"BAR"==this.currentToken.type||this.errorHandler.throw("EXPECTED '|' AFTER FUNCTION DECLARATION",this.prevToken.line,this.prevToken.col),this.next();this.currentToken&&"BAR"!=this.currentToken.type&&(this.args.push(this.currentToken),this.next(),this.currentToken||this.errorHandler.throw("EXPECTED '|' AFTER ARGUMENT LIST",this.prevToken.line,this.prevToken.col),"COMMA"!=this.currentToken.type&&"BAR"!=this.currentToken.type&&this.errorHandler.throw("EXPECTED ',' AFTER ARGUMENT",this.prevToken.line,this.prevToken.col),"BAR"!=this.currentToken.type);)this.next();this.next(),this.currentToken&&"FATARROW"==this.currentToken.type||this.errorHandler.throw("EXPECTED '=>' AFTER FN DECLARATION",this.prevToken.line,this.prevToken.col),this.next(),this.body=this.statement.slice(this.index),this.body.push({type:"SEMICOLON",value:";"})}execute(){this.splitBlock();const e=new ZapFunction(this.identifier,this.args,this.body,this.environment);this.environment.define(this.identifier,e)}}class Parser{constructor(e){this.environment=e,this.evaluator=new Evaluator(this.environment),this.errorHandler=new ErrorHandler,this.log=globalLog,this.tokens=null,this.index=null,this.currentToken=null,this.previousToken=null,this.statements=[],this.currentStatement=[],this.openingBrace=0,this.closingBrace=0}load(e){this.tokens=e,this.index=0,this.currentToken=this.currentToken=this.tokens[this.index],this.previousToken=null,this.openingBrace=0,this.closingBrace=0,this.checkBrace()}resetCurrentStatement(){this.currentStatement=[]}checkBrace(){this.currentToken&&("LBRACE"==this.currentToken.type&&this.openingBrace++,"RBRACE"==this.currentToken.type&&this.closingBrace++)}next(){this.index++,this.currentToken=this.tokens[this.index],this.previousToken=this.tokens[this.index-1],this.checkBrace()}isInBlock(){return this.openingBrace!=this.closingBrace}isSemicolon(){return"SEMICOLON"==this.currentToken.type}handleBlock(e){return new BlockStmt(e,new Environment(this.environment))}handlePrint(e){return new PrintStmt(e,this.evaluator,this.log)}handleDeclaration(e){return new DeclarationStmt(e,this.evaluator,this.environment)}handleIf(e){return new IfStmt(e,this.evaluator,this.environment)}handleExpression(e){return new ExprStmt(e,this.evaluator)}handleWhile(e){return new WhileStmt(e,this.evaluator,this.environment)}handleFunction(e){return new FunctionStmt(e,this.evaluator,this.environment)}handleStatement(e){return"LBRACE"==e[0].type?this.handleBlock(e):"SHOW"==e[0].type?this.handlePrint(e):"DECLARATOR"==e[0].type?this.handleDeclaration(e):"IF"==e[0].type?this.handleIf(e):"WHILE"==e[0].type?this.handleWhile(e):"FUNCTION"==e[0].type?this.handleFunction(e):this.handleExpression(e)}parse(){for(;this.currentToken;)if(this.isInBlock()){if(this.currentStatement.push(this.currentToken),!this.isInBlock()){let e=this.handleStatement(this.currentStatement);this.statements.push(e),this.resetCurrentStatement()}this.next()}else{if(this.isSemicolon()){let e=this.handleStatement(this.currentStatement);this.statements.push(e),this.resetCurrentStatement()}else this.currentStatement.push(this.currentToken);this.next()}return this.currentStatement.length&&this.errorHandler.throw("YOU MUST HAVE FORGOTTEN A SEMICOLON OR CLOSING BRACE",this.previousToken.line,this.previousToken.col),this.statements}}class ZapFunction{constructor(e,t,i,n){this.errorHandler=new ErrorHandler,this.environment=new Environment(n),this.parser=new Parser(this.environment),this.name=e,this.args=t,this.body=i,this.arity=t.length}call(e){e.length!=this.args.length&&this.errorHandler.throw(`INVALID NUMBER OF ARGUMENTS PASSED TO ${this.name}`);for(let t=0;t<e.length;t++)this.environment.define(this.args[t].value,e[t]);this.parser.load(this.body),this.parser.parse()}}class kiswahiliScript{constructor(e){this.input=e,this.interpreter=new Interpreter(this.input)}}function Compile(){var e=editor.getValue();const t=performance.now(),i=(new kiswahiliScript(e),globalLog.values.map((e=>e.log?e.log:e.error?`Error: ${e.error.message} at line ${e.error.line}`:"")).join("<br>"));document.getElementById("s").innerHTML=i;const n=performance.now(),r=n-t;document.getElementById("s").innerHTML=`\n            kiswahiliScript with .kiss\n            ========  ====== ====== =====\n            \n            <div>Time taken: ${r.toFixed(2)} ms</div>\n            ~~~ compilation results ~~~~~~\n            \n            <div>${i}</div>\n            ====>time start:${t}\n            ====>time end:${n}\n            \n            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n            developed by Silivestir Assey ,Isack Wagunda\n            Under splannes team ©splannes 2024\n            maintained by Silivestir Assey \n            -------     ----------   ----------\n            see docs at kiswahiliScript page\n            report bugs,disclaimer,privacy,\n            \n            `}function openModal(){document.getElementById("fileModal").style.display="block"}function closeModal(){document.getElementById("fileModal").style.display="none"}function toggleTerminal(){var e=document.getElementById("editorContainer"),t=document.getElementById("terminalContainer");t.classList.contains("hidden")?(e.classList.add("hidden"),t.classList.remove("hidden"),document.getElementById("terminalInput").focus()):(t.classList.add("hidden"),e.classList.remove("hidden"))}document.getElementById("fileForm").addEventListener("submit",(function(e){e.preventDefault(),createFile(document.getElementById("fileName").value)}));var isDone=!1;function executeCommand(e){const t=document.getElementById("terminalOutput"),i=e.trim().split(/\s+/),n=i[0],r=i[1];if("kiswahili"===n)switch(i[1]){case"clear":t.innerHTML="";break;case"mkfile":createFile(i[2]),t.innerHTML+="> File created\n";break;case"run":isDone||(t.innerHTML+="><span>huez ku run program bila ku compail "),isDone&&compile();break;case"compail":t.innerHTML+="> Compilation successful\n",isDone=!0,setTimeout((function(){t.innerHTML+="> <br>.."}),1e3),setTimeout((function(){t.innerHTML+=" ......."}),1e3),setTimeout((function(){t.innerHTML+="> now run your program\n"}),1e3);break;case"delete":delete files[r],t.innerHTML+="> File deleted\n",updateFileList();break;default:i[1].endsWith(".kiss")?handleFileCommands(i[1],i[0]):t.innerHTML+="> Unknown command\n"}else t.innerHTML+="> Unknown command\n";t.scrollTop=t.scrollHeight}function handleFileCommands(e,t){const i=document.getElementById("terminalOutput");"compile"===t?files[e]?(alert(files[e]),i.innerHTML+="> Compilation successful\n"):i.innerHTML+="> Compilation error: File not found\n":"run"===t?files[e]?(i.innerHTML+="> Running program...\n",i.innerHTML+=`> ${files[e]}\n`):i.innerHTML+="> Error: File not found\n":"delete"===t?files[e]?(delete files[e],i.innerHTML+="> File deleted\n",updateFileList()):i.innerHTML+="> Error: File not found\n":i.innerHTML+="> Unknown file command  ${args[1]}\n"}function compile(){var e=editor.getValue();const t=performance.now(),i=(new kiswahiliScript(e),globalLog.values.map((e=>e.log?e.log:e.error?`Error: ${e.error.message} at line ${e.error.line}`:"")).join("<br>")),n=document.getElementById("terminalOutput");n.innerHTML=i;const r=performance.now(),s=r-t;n.innerHTML=`\n            kiswahiliScript with .kiss\n            ========  ====== ====== =====\n            \n            <div>Time taken: ${s.toFixed(2)} ms</div>\n            ~~~ compilation results ~~~~~~\n            \n            <div>${i}</div>\n            ====>time start:${t}\n            ====>time end:${r}\n            \n            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n            developed by Silivestir Assey ,Isack Wagunda\n            Under splannes team ©splannes 2024\n            maintained by Silivestir Assey \n            -------     ----------   ----------\n            see docs at kiswahiliScript page\n            report bugs,disclaimer,privacy,\n            \n            `}document.getElementById("terminalInput").addEventListener("keypress",(function(e){if("Enter"===e.key){e.preventDefault();executeCommand(this.value),this.value=""}}))</script>
</body>
</html>
